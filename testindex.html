<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>eBuy Marketplace - Smart Recommendations</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        .pulse-border { animation: pulse 2s cubic-bezier(0.4, 0, 0.6, 1) infinite; }
        @keyframes pulse { 0%, 100% { border-color: rgb(147, 51, 234); } 50% { border-color: rgb(236, 72, 153); } }
    </style>
</head>
<body class="bg-gray-50">
    <div id="app"></div>

    <script crossorigin src="https://cdnjs.cloudflare.com/ajax/libs/react/18.2.0/umd/react.production.min.js"></script>
    <script crossorigin src="https://cdnjs.cloudflare.com/ajax/libs/react-dom/18.2.0/umd/react-dom.production.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/babel-standalone/7.23.5/babel.min.js"></script>
    
    <script type="text/babel">
        const { useState, useEffect } = React;

        const Icon = ({ type, size = 24, className = "" }) => {
            const icons = {
                search: <svg className={className} width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><circle cx="11" cy="11" r="8"/><path d="m21 21-4.35-4.35"/></svg>,
                cart: <svg className={className} width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><circle cx="9" cy="21" r="1"/><circle cx="20" cy="21" r="1"/><path d="M1 1h4l2.68 13.39a2 2 0 0 0 2 1.61h9.72a2 2 0 0 0 2-1.61L23 6H6"/></svg>,
                heart: <svg className={className} width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><path d="M20.84 4.61a5.5 5.5 0 0 0-7.78 0L12 5.67l-1.06-1.06a5.5 5.5 0 0 0-7.78 7.78l1.06 1.06L12 21.23l7.78-7.78 1.06-1.06a5.5 5.5 0 0 0 0-7.78z"/></svg>,
                user: <svg className={className} width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"/><circle cx="12" cy="7" r="4"/></svg>,
                trending: <svg className={className} width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><polyline points="23 6 13.5 15.5 8.5 10.5 1 18"/><polyline points="17 6 23 6 23 12"/></svg>,
                clock: <svg className={className} width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><circle cx="12" cy="12" r="10"/><polyline points="12 6 12 12 16 14"/></svg>,
                star: <svg className={className} width={size} height={size} viewBox="0 0 24 24" fill="currentColor" stroke="currentColor" strokeWidth="2"><polygon points="12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2"/></svg>,
                brain: <svg className={className} width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><path d="M9.5 2A2.5 2.5 0 0 1 12 4.5v15a2.5 2.5 0 0 1-4.96.44 2.5 2.5 0 0 1-2.96-3.08 3 3 0 0 1-.34-5.58 2.5 2.5 0 0 1 1.32-4.24 2.5 2.5 0 0 1 1.98-3A2.5 2.5 0 0 1 9.5 2Z"/><path d="M14.5 2A2.5 2.5 0 0 0 12 4.5v15a2.5 2.5 0 0 0 4.96.44 2.5 2.5 0 0 0 2.96-3.08 3 3 0 0 0 .34-5.58 2.5 2.5 0 0 0-1.32-4.24 2.5 2.5 0 0 0-1.98-3A2.5 2.5 0 0 0 14.5 2Z"/></svg>,
                chart: <svg className={className} width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><line x1="18" y1="20" x2="18" y2="10"/><line x1="12" y1="20" x2="12" y2="4"/><line x1="6" y1="20" x2="6" y2="14"/></svg>,
                eye: <svg className={className} width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"/><circle cx="12" cy="12" r="3"/></svg>
            };
            return icons[type] || null;
        };

        const EbayMarketplace = () => {
            const [searchTerm, setSearchTerm] = useState('');
            const [viewHistory, setViewHistory] = useState([]);
            const [cart, setCart] = useState([]);
            const [favorites, setFavorites] = useState([]);
            const [selectedCategory, setSelectedCategory] = useState('all');
            const [userProfile, setUserProfile] = useState({
                priceRange: { min: 0, max: 2000 },
                preferredConditions: {},
                sessionStart: Date.now(),
                totalViews: 0,
                categoryAffinity: {}
            });
            const [showInsights, setShowInsights] = useState(false);

            const products = [
                { id: 1, name: 'Vintage Camera', price: 299, category: 'electronics', image: 'ðŸ“·', condition: 'Used', tags: ['photography', 'vintage', 'collector'] },
                { id: 2, name: 'Designer Handbag', price: 850, category: 'fashion', image: 'ðŸ‘œ', condition: 'New', tags: ['luxury', 'designer', 'accessories'] },
                { id: 3, name: 'Gaming Laptop', price: 1299, category: 'electronics', image: 'ðŸ’»', condition: 'Refurbished', tags: ['gaming', 'tech', 'powerful'] },
                { id: 4, name: 'Leather Jacket', price: 450, category: 'fashion', image: 'ðŸ§¥', condition: 'Used', tags: ['vintage', 'leather', 'outerwear'] },
                { id: 5, name: 'Smartphone', price: 699, category: 'electronics', image: 'ðŸ“±', condition: 'New', tags: ['mobile', 'communication', 'tech'] },
                { id: 6, name: 'Running Shoes', price: 120, category: 'sports', image: 'ðŸ‘Ÿ', condition: 'New', tags: ['fitness', 'running', 'athletic'] },
                { id: 7, name: 'Mechanical Keyboard', price: 180, category: 'electronics', image: 'âŒ¨ï¸', condition: 'New', tags: ['gaming', 'productivity', 'tech'] },
                { id: 8, name: 'Yoga Mat', price: 45, category: 'sports', image: 'ðŸ§˜', condition: 'New', tags: ['fitness', 'yoga', 'wellness'] },
                { id: 9, name: 'Sunglasses', price: 220, category: 'fashion', image: 'ðŸ•¶ï¸', condition: 'New', tags: ['accessories', 'summer', 'style'] },
                { id: 10, name: 'Wireless Headphones', price: 280, category: 'electronics', image: 'ðŸŽ§', condition: 'New', tags: ['audio', 'wireless', 'music'] },
                { id: 11, name: 'Luxury Watch', price: 550, category: 'fashion', image: 'âŒš', condition: 'Used', tags: ['luxury', 'accessories', 'timepiece'] },
                { id: 12, name: 'Mountain Bicycle', price: 890, category: 'sports', image: 'ðŸš´', condition: 'Used', tags: ['outdoor', 'cycling', 'adventure'] },
                { id: 13, name: 'Drone Camera', price: 599, category: 'electronics', image: 'ðŸš', condition: 'New', tags: ['photography', 'tech', 'aerial'] },
                { id: 14, name: 'Designer Wallet', price: 250, category: 'fashion', image: 'ðŸ‘›', condition: 'New', tags: ['luxury', 'accessories', 'leather'] },
                { id: 15, name: 'Fitness Tracker', price: 199, category: 'sports', image: 'âŒš', condition: 'New', tags: ['fitness', 'tech', 'health'] },
            ];

            const ads = [
                { id: 'ad1', name: 'Premium Camera Lenses', price: 399, category: 'electronics', image: 'ðŸ“¸', targetCategories: ['electronics'], tags: ['photography', 'tech'], reason: 'category' },
                { id: 'ad2', name: 'Designer Wallet', price: 250, category: 'fashion', image: 'ðŸ‘›', targetCategories: ['fashion'], tags: ['luxury', 'accessories'], reason: 'category' },
                { id: 'ad3', name: 'Gaming Mouse Pro', price: 89, category: 'electronics', image: 'ðŸ–±ï¸', targetCategories: ['electronics'], tags: ['gaming', 'tech'], reason: 'category' },
                { id: 'ad4', name: 'Smart Fitness Band', price: 199, category: 'sports', image: 'âŒš', targetCategories: ['sports', 'electronics'], tags: ['fitness', 'tech'], reason: 'cross-category' },
                { id: 'ad5', name: 'Luxury Perfume Set', price: 150, category: 'fashion', image: 'ðŸ’', targetCategories: ['fashion'], tags: ['luxury', 'accessories'], reason: 'category' },
                { id: 'ad6', name: 'Professional Tripod', price: 129, category: 'electronics', image: 'ðŸ“', targetCategories: ['electronics'], tags: ['photography', 'accessories'], reason: 'related' },
                { id: 'ad7', name: 'Yoga Block Set', price: 35, category: 'sports', image: 'ðŸ§±', targetCategories: ['sports'], tags: ['fitness', 'yoga'], reason: 'related' },
                { id: 'ad8', name: 'Smart Watch Premium', price: 449, category: 'fashion', image: 'âŒš', targetCategories: ['fashion', 'electronics'], tags: ['luxury', 'tech'], reason: 'cross-category' },
            ];

            const handleProductView = (product) => {
                const newHistory = [...viewHistory, { 
                    ...product, 
                    timestamp: Date.now(),
                    timeSpent: Math.random() * 30 + 10 // Simulated time
                }];
                setViewHistory(newHistory.slice(-20));

                // Update user profile
                setUserProfile(prev => ({
                    ...prev,
                    totalViews: prev.totalViews + 1,
                    categoryAffinity: {
                        ...prev.categoryAffinity,
                        [product.category]: (prev.categoryAffinity[product.category] || 0) + 1
                    },
                    preferredConditions: {
                        ...prev.preferredConditions,
                        [product.condition]: (prev.preferredConditions[product.condition] || 0) + 1
                    }
                }));
            };

            const toggleFavorite = (product) => {
                if (favorites.find(f => f.id === product.id)) {
                    setFavorites(favorites.filter(f => f.id !== product.id));
                } else {
                    setFavorites([...favorites, product]);
                }
            };

            // Advanced recommendation algorithm
            const getPersonalizedAds = () => {
                if (viewHistory.length === 0) {
                    return ads.slice(0, 3);
                }

                // Calculate category weights
                const categoryScores = {};
                viewHistory.forEach((item, idx) => {
                    const recency = 1 - (idx / viewHistory.length); // More recent = higher score
                    const weight = recency * (item.timeSpent / 30); // Time spent factor
                    categoryScores[item.category] = (categoryScores[item.category] || 0) + weight;
                });

                // Calculate tag affinity
                const tagScores = {};
                viewHistory.forEach(item => {
                    item.tags.forEach(tag => {
                        tagScores[tag] = (tagScores[tag] || 0) + 1;
                    });
                });

                // Price range analysis
                const viewedPrices = viewHistory.map(h => h.price);
                const avgPrice = viewedPrices.reduce((a, b) => a + b, 0) / viewedPrices.length;
                const priceStdDev = Math.sqrt(
                    viewedPrices.reduce((sum, price) => sum + Math.pow(price - avgPrice, 2), 0) / viewedPrices.length
                );

                // Score ads
                const scoredAds = ads.map(ad => {
                    let score = 0;

                    // Category match
                    ad.targetCategories.forEach(cat => {
                        score += (categoryScores[cat] || 0) * 3;
                    });

                    // Tag match
                    ad.tags.forEach(tag => {
                        score += (tagScores[tag] || 0) * 2;
                    });

                    // Price range match
                    const priceDiff = Math.abs(ad.price - avgPrice);
                    if (priceDiff <= priceStdDev) {
                        score += 2;
                    }

                    // Favorite category boost
                    if (favorites.length > 0) {
                        const favCategories = favorites.map(f => f.category);
                        if (ad.targetCategories.some(cat => favCategories.includes(cat))) {
                            score += 3;
                        }
                    }

                    return { ...ad, score };
                });

                return scoredAds
                    .sort((a, b) => b.score - a.score)
                    .slice(0, 3);
            };

            // Related products based on current view
            const getRelatedProducts = () => {
                if (viewHistory.length === 0) return [];

                const recentView = viewHistory[viewHistory.length - 1];
                
                return products
                    .filter(p => p.id !== recentView.id)
                    .map(p => {
                        let relevance = 0;
                        if (p.category === recentView.category) relevance += 5;
                        p.tags.forEach(tag => {
                            if (recentView.tags.includes(tag)) relevance += 2;
                        });
                        const priceDiff = Math.abs(p.price - recentView.price);
                        if (priceDiff < 200) relevance += 3;
                        return { ...p, relevance };
                    })
                    .sort((a, b) => b.relevance - a.relevance)
                    .slice(0, 4);
            };

            const getUserInsights = () => {
                if (viewHistory.length === 0) return null;

                const categories = Object.entries(userProfile.categoryAffinity)
                    .sort((a, b) => b[1] - a[1]);
                
                const avgPrice = viewHistory.reduce((sum, h) => sum + h.price, 0) / viewHistory.length;
                const sessionDuration = (Date.now() - userProfile.sessionStart) / 1000 / 60; // minutes

                return {
                    topCategory: categories[0]?.[0] || 'none',
                    totalViewed: viewHistory.length,
                    avgPrice: Math.round(avgPrice),
                    sessionTime: Math.round(sessionDuration),
                    engagementRate: ((viewHistory.length / sessionDuration) * 10).toFixed(1)
                };
            };

            const filteredProducts = products.filter(p => 
                (selectedCategory === 'all' || p.category === selectedCategory) &&
                (searchTerm === '' || p.name.toLowerCase().includes(searchTerm.toLowerCase()))
            );

            const personalizedAds = getPersonalizedAds();
            const relatedProducts = getRelatedProducts();
            const insights = getUserInsights();

            return (
                <div className="min-h-screen bg-gray-50">
                    <header className="bg-white shadow-sm border-b">
                        <div className="max-w-7xl mx-auto px-4 py-4">
                            <div className="flex items-center justify-between mb-4">
                                <h1 className="text-3xl font-bold text-blue-600">eBuy</h1>
                                <div className="flex gap-4 items-center">
                                    {viewHistory.length > 0 && (
                                        <button 
                                            onClick={() => setShowInsights(!showInsights)}
                                            className="p-2 hover:bg-gray-100 rounded-full relative"
                                        >
                                            <Icon type="brain" className="text-purple-600" />
                                            <span className="absolute -top-1 -right-1 bg-purple-500 text-white text-xs rounded-full w-5 h-5 flex items-center justify-center">
                                                {viewHistory.length}
                                            </span>
                                        </button>
                                    )}
                                    <button className="p-2 hover:bg-gray-100 rounded-full relative">
                                        <Icon type="heart" />
                                        {favorites.length > 0 && (
                                            <span className="absolute -top-1 -right-1 bg-red-500 text-white text-xs rounded-full w-5 h-5 flex items-center justify-center">
                                                {favorites.length}
                                            </span>
                                        )}
                                    </button>
                                    <button className="p-2 hover:bg-gray-100 rounded-full relative">
                                        <Icon type="cart" />
                                        {cart.length > 0 && (
                                            <span className="absolute -top-1 -right-1 bg-red-500 text-white text-xs rounded-full w-5 h-5 flex items-center justify-center">
                                                {cart.length}
                                            </span>
                                        )}
                                    </button>
                                    <button className="p-2 hover:bg-gray-100 rounded-full">
                                        <Icon type="user" />
                                    </button>
                                </div>
                            </div>
                            
                            <div className="flex gap-2">
                                <div className="flex-1 relative">
                                    <div className="absolute left-3 top-3 text-gray-400">
                                        <Icon type="search" size={20} />
                                    </div>
                                    <input
                                        type="text"
                                        placeholder="Search for anything"
                                        className="w-full pl-10 pr-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:border-blue-500"
                                        value={searchTerm}
                                        onChange={(e) => setSearchTerm(e.target.value)}
                                    />
                                </div>
                                <button className="px-6 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700">
                                    Search
                                </button>
                            </div>
                        </div>
                    </header>

                    <div className="max-w-7xl mx-auto px-4 py-6">
                        {/* User Insights Dashboard */}
                        {showInsights && insights && (
                            <div className="mb-6 bg-gradient-to-r from-indigo-50 to-purple-50 rounded-lg p-6 border-2 border-indigo-200">
                                <div className="flex items-center gap-2 mb-4">
                                    <Icon type="chart" className="text-indigo-600" />
                                    <h2 className="text-xl font-bold text-gray-800">Your Shopping Insights</h2>
                                </div>
                                <div className="grid grid-cols-2 md:grid-cols-4 gap-4">
                                    <div className="bg-white p-4 rounded-lg">
                                        <div className="text-2xl font-bold text-indigo-600">{insights.totalViewed}</div>
                                        <div className="text-sm text-gray-600">Items Viewed</div>
                                    </div>
                                    <div className="bg-white p-4 rounded-lg">
                                        <div className="text-2xl font-bold text-green-600">${insights.avgPrice}</div>
                                        <div className="text-sm text-gray-600">Avg Price Range</div>
                                    </div>
                                    <div className="bg-white p-4 rounded-lg">
                                        <div className="text-2xl font-bold text-purple-600 capitalize">{insights.topCategory}</div>
                                        <div className="text-sm text-gray-600">Top Interest</div>
                                    </div>
                                    <div className="bg-white p-4 rounded-lg">
                                        <div className="text-2xl font-bold text-blue-600">{insights.engagementRate}</div>
                                        <div className="text-sm text-gray-600">Views/Min</div>
                                    </div>
                                </div>
                            </div>
                        )}

                        {/* Categories */}
                        <div className="flex gap-2 mb-6 overflow-x-auto pb-2">
                            {['all', 'electronics', 'fashion', 'sports'].map(cat => (
                                <button
                                    key={cat}
                                    onClick={() => setSelectedCategory(cat)}
                                    className={`px-4 py-2 rounded-full whitespace-nowrap flex items-center gap-2 ${
                                        selectedCategory === cat
                                            ? 'bg-blue-600 text-white'
                                            : 'bg-white border hover:border-blue-500'
                                    }`}
                                >
                                    {cat.charAt(0).toUpperCase() + cat.slice(1)}
                                    {userProfile.categoryAffinity[cat] > 0 && (
                                        <span className="text-xs bg-white text-blue-600 rounded-full px-2">
                                            {userProfile.categoryAffinity[cat]}
                                        </span>
                                    )}
                                </button>
                            ))}
                        </div>

                        {/* AI Personalized Recommendations */}
                        <div className="mb-8 bg-gradient-to-r from-purple-50 to-pink-50 rounded-lg p-6 border-2 border-purple-200 pulse-border">
                            <div className="flex items-center gap-2 mb-4">
                                <Icon type="brain" className="text-purple-600" />
                                <h2 className="text-xl font-bold text-gray-800">
                                    AI Personalized For You
                                </h2>
                                {viewHistory.length > 0 && (
                                    <span className="text-sm text-gray-600 ml-2">
                                        (Based on {viewHistory.length} viewed items)
                                    </span>
                                )}
                            </div>
                            <div className="grid grid-cols-1 md:grid-cols-3 gap-4">
                                {personalizedAds.map(ad => (
                                    <div key={ad.id} className="bg-white rounded-lg shadow-md p-4 border-2 border-purple-300 hover:shadow-xl transition-all hover:scale-105">
                                        <div className="text-6xl mb-3 text-center">{ad.image}</div>
                                        <div className="flex items-center justify-between mb-2">
                                            <span className="bg-purple-100 text-purple-700 text-xs px-2 py-1 rounded font-semibold">
                                                SPONSORED
                                            </span>
                                            {ad.score && (
                                                <span className="text-xs text-gray-500">
                                                    {Math.round(ad.score * 10)}% match
                                                </span>
                                            )}
                                        </div>
                                        <h3 className="font-semibold text-lg mb-1">{ad.name}</h3>
                                        <div className="flex flex-wrap gap-1 mb-2">
                                            {ad.tags.slice(0, 2).map(tag => (
                                                <span key={tag} className="text-xs bg-gray-100 px-2 py-1 rounded">
                                                    {tag}
                                                </span>
                                            ))}
                                        </div>
                                        <p className="text-2xl font-bold text-blue-600 mb-3">
                                            ${ad.price}
                                        </p>
                                        <button className="w-full bg-gradient-to-r from-purple-600 to-pink-600 text-white py-2 rounded-lg hover:from-purple-700 hover:to-pink-700 transition-colors">
                                            View Item
                                        </button>
                                    </div>
                                ))}
                            </div>
                        </div>

                        {/* Recently Viewed + Related */}
                        {viewHistory.length > 0 && (
                            <div className="grid grid-cols-1 md:grid-cols-2 gap-6 mb-6">
                                <div className="bg-white rounded-lg p-4 shadow">
                                    <div className="flex items-center gap-2 mb-3">
                                        <Icon type="clock" size={20} className="text-gray-600" />
                                        <h3 className="font-semibold text-gray-800">Recently Viewed</h3>
                                    </div>
                                    <div className="flex gap-3 overflow-x-auto pb-2">
                                        {viewHistory.slice(-5).reverse().map((item, idx) => (
                                            <div key={idx} className="flex flex-col items-center min-w-[80px] cursor-pointer hover:scale-110 transition-transform">
                                                <div className="text-3xl mb-1">{item.image}</div>
                                                <span className="text-xs text-gray-600 text-center">{item.name}</span>
                                                <span className="text-xs text-blue-600">${item.price}</span>
                                            </div>
                                        ))}
                                    </div>
                                </div>

                                <div className="bg-white rounded-lg p-4 shadow">
                                    <div className="flex items-center gap-2 mb-3">
                                        <Icon type="eye" size={20} className="text-green-600" />
                                        <h3 className="font-semibold text-gray-800">You Might Also Like</h3>
                                    </div>
                                    <div className="flex gap-3 overflow-x-auto pb-2">
                                        {relatedProducts.map((item) => (
                                            <div 
                                                key={item.id} 
                                                onClick={() => handleProductView(item)}
                                                className="flex flex-col items-center min-w-[80px] cursor-pointer hover:scale-110 transition-transform"
                                            >
                                                <div className="text-3xl mb-1">{item.image}</div>
                                                <span className="text-xs text-gray-600 text-center">{item.name}</span>
                                                <span className="text-xs text-green-600">${item.price}</span>
                                            </div>
                                        ))}
                                    </div>
                                </div>
                            </div>
                        )}

                        {/* Products Grid */}
                        <div className="mb-4">
                            <h3 className="text-lg font-semibold text-gray-800 mb-3">Browse All Items</h3>
                        </div>
                        <div className="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4">
                            {filteredProducts.map(product => {
                                const isFavorite = favorites.find(f => f.id === product.id);
                                return (
                                    <div
                                        key={product.id}
                                        className="bg-white rounded-lg shadow hover:shadow-lg transition-shadow p-4 cursor-pointer relative"
                                        onClick={() => handleProductView(product)}
                                    >
                                        <button
                                            onClick={(e) => {
                                                e.stopPropagation();
                                                toggleFavorite(product);
                                            }}
                                            className="absolute top-2 right-2 p-2 hover:bg-gray-100 rounded-full z
